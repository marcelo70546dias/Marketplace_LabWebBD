@model CreateAnuncioViewModel

@{
    ViewData["Title"] = "Criar Novo Anúncio";
}

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12 d-flex justify-content-between align-items-center">
            <div>
                <h2><i class="bi bi-plus-circle"></i> Criar Novo Anúncio</h2>
                <p class="text-muted mb-0">Publique um novo veículo para venda</p>
            </div>
            <div>
                <a asp-action="MeusAnuncios" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Voltar
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-10 mx-auto">
            <form asp-action="CreateAnuncio" method="post" enctype="multipart/form-data">
                <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                <!-- Detalhes do Anúncio -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-megaphone"></i> Informação do Anúncio</h5>
                    </div>
                    <div class="card-body">
                        <!-- Título -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label asp-for="Titulo" class="form-label"></label>
                                <input asp-for="Titulo" class="form-control" placeholder="Ex: BMW Série 3 320d Sport" required />
                                <span asp-validation-for="Titulo" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detalhes do Veículo -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-car-front"></i> Detalhes do Veículo</h5>
                    </div>
                    <div class="card-body">
                        <!-- Categoria -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label asp-for="Categoria" class="form-label"></label>
                                <select asp-for="Categoria" asp-items="Model.Categorias" class="form-select" required>
                                </select>
                                <span asp-validation-for="Categoria" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Marca e Modelo -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="ID_Marca" class="form-label"></label>
                                <select asp-for="ID_Marca" asp-items="Model.Marcas" class="form-select" id="marcaSelect" required>
                                </select>
                                <span asp-validation-for="ID_Marca" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="ID_Modelo" class="form-label"></label>
                                <select asp-for="ID_Modelo" asp-items="Model.Modelos" class="form-select" id="modeloSelect" required>
                                    <option value="">Primeiro selecione a marca...</option>
                                </select>
                                <span asp-validation-for="ID_Modelo" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Preço -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label asp-for="Preco" class="form-label"></label>
                                <div class="input-group">
                                    <span class="input-group-text">€</span>
                                    <input asp-for="Preco" class="form-control" placeholder="25000.00" required />
                                </div>
                                <span asp-validation-for="Preco" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Ano e Quilometragem -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Ano" class="form-label"></label>
                                <input asp-for="Ano" class="form-control" placeholder="2020" required />
                                <span asp-validation-for="Ano" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Quilometragem" class="form-label"></label>
                                <div class="input-group">
                                    <input asp-for="Quilometragem" class="form-control" placeholder="50000" required />
                                    <span class="input-group-text">km</span>
                                </div>
                                <span asp-validation-for="Quilometragem" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Transmissão e Combustível -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Caixa" class="form-label"></label>
                                <select asp-for="Caixa" asp-items="Model.Transmissoes" class="form-select" required>
                                </select>
                                <span asp-validation-for="Caixa" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="ID_Combustivel" class="form-label"></label>
                                <select asp-for="ID_Combustivel" asp-items="Model.Combustiveis" class="form-select" required>
                                </select>
                                <span asp-validation-for="ID_Combustivel" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Cor e Lotação -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Cor" class="form-label"></label>
                                <select asp-for="Cor" asp-items="Model.Cores" class="form-select" required>
                                    <option value="">Selecione a cor...</option>
                                </select>
                                <span asp-validation-for="Cor" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Lotacao" class="form-label"></label>
                                <input asp-for="Lotacao" class="form-control" type="number" min="1" max="50" placeholder="5" required />
                                <span asp-validation-for="Lotacao" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Localização -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label asp-for="Localizacao" class="form-label"></label>
                                <select asp-for="Localizacao" asp-items="Model.Distritos" class="form-select" required>
                                </select>
                                <span asp-validation-for="Localizacao" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Descrição -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label asp-for="Descricao" class="form-label"></label>
                                <textarea asp-for="Descricao" class="form-control" rows="5"
                                          placeholder="Descreva o veículo: estado, extras, histórico de manutenção, etc."></textarea>
                                <span asp-validation-for="Descricao" class="text-danger"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fotografias -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="bi bi-images"></i> Fotografias</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Adicionar Fotos</label>
                            <input type="file" name="Fotos" class="form-control" multiple accept="image/*" />
                            <small class="form-text text-muted">
                                Pode selecionar múltiplas imagens. Máximo 5MB por imagem.
                                Formatos aceites: JPG, JPEG, PNG, WEBP
                            </small>
                        </div>
                        <div class="alert alert-info mb-0">
                            <i class="bi bi-info-circle"></i>
                            <strong>Dica:</strong> Adicione fotos de qualidade do exterior, interior, motor e documentação do veículo para atrair mais compradores.
                        </div>
                    </div>
                </div>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <a asp-action="MeusAnuncios" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Criar Anúncio
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        // Cascading dropdown: Marca → Modelo
        $(document).ready(function() {
            $('#marcaSelect').change(function() {
                var marcaId = $(this).val();
                var modeloSelect = $('#modeloSelect');

                modeloSelect.empty();
                modeloSelect.append('<option value="">Carregando modelos...</option>');

                if (marcaId) {
                    $.getJSON('@Url.Action("GetModelosByMarca")', { marcaId: marcaId }, function(data) {
                        modeloSelect.empty();
                        modeloSelect.append('<option value="">Selecione o modelo...</option>');
                        $.each(data, function(index, item) {
                            modeloSelect.append($('<option></option>').val(item.value).text(item.text));
                        });
                    }).fail(function() {
                        modeloSelect.empty();
                        modeloSelect.append('<option value="">Erro ao carregar modelos</option>');
                    });
                } else {
                    modeloSelect.empty();
                    modeloSelect.append('<option value="">Primeiro selecione a marca...</option>');
                }
            });
        });
    </script>
}
